<!DOCTYPE html>
<html>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      document.getElementById("btn").addEventListener("click", async () => {
        const urlsearch = "http://localhost:3000/kapibara/";
        let exp = new Object();
        exp = {
          name: document.getElementById("name").value,
          change: {
            feature: document.getElementById("feture").value,
          },
        };

        const response = await fetch("http://localhost:3000/kapibara", {
          method: "PATCH", //patchと書くとエラーになる
          body: JSON.stringify(exp),
          headers: {
            "Content-Type": "application/json",
          },
        });
        const statuscode = await response.status;

        if (statuscode === 200) {
          const data = await response.json();
          const createok = "<h1>更新成功！</h1>";
          let result = document.getElementById("result");
          let div = document.createElement("div");
          div.innerHTML = createok; //html要素に変換
          result.appendChild(div, result);
        } else if (statuscode === 400) {
          alert(data.errors[0].param + ":" + data.errors[0].msg);
        } else {
          alert("statuscode:" + statuscode);
        }
      });
    });

    /*        XMLHttpRequestを使用した場合（patchメソッドにアクセスできなかったため削除）
            document.addEventListener('DOMContentLoaded',function(){
            let x=new XMLHttpRequest();
            let exp = new Object();
            
     exp= {
      name: "テストカピ",
      change: {
        feature: "架空の存在。修正された。後は消されるだけ。",
      },
    };
        let result=document.getElementById('result');
        x.open("put", "http://localhost:3000/kapibara",true);
        x.setRequestHeader('content-type',	'application/json; charset=utf-8');
        x.send(JSON.stringify(exp));
        x.onreadystatechange = function () {
            console.log(x.readyState);
            if(x.readyState===4){
                console.log(x.response);
            }
        };        
        },false);
        */
  </script>
  <head></head>
  <body>
    <h2>情報を入力してください</h2>
    <label>更新するカピバラの名前：</label
    ><input id="name" type="text" name="name" size="15" value="旅カピ" /> <br />
    <h3>更新する情報を入力してください</h3>
    <!--    <label>名前：</label><input id="changename" type="text" name="name" size="15"/> <br>
    <label>主な住処：</label><input id="habitat" type="text" name="Habitat" size="30"/> <br>
    <label>写真：</label><input id="picUrl" type="text" name="pictureUrl" size="30"/> <br> -->
    <label>特徴：</label
    ><input
      id="feture"
      type="text"
      name="feature"
      size="80"
      value="小さい体ゆえにカバンに潜り込んで各国を旅しているカピバラ。最近毛並みが悪くなった。"
    />
    <br />
    <input id="btn" type="button" name="submit" value="登録" />
    <div id="result"></div>
  </body>
</html>
